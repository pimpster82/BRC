<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content="Bible Reading Companion - Track your daily Bible reading" />
    <meta name="theme-color" content="#1E40AF" />

    <!-- PWA Manifest (cache busted with version) -->
    <link rel="manifest" href="/manifest.json?v=1.1.1" />

    <!-- Favicon & App Icons (Browser) -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-light-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-light-512.png" />
    <link rel="icon" type="image/svg+xml" href="/icons/open-bible-icon.svg" />

    <!-- Dark mode favicon support (prefers-color-scheme) -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-dark-192.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-dark-512.png" media="(prefers-color-scheme: dark)" />

    <!-- iOS App Icons (iOS 25+ - Light Mode primary) -->
    <link rel="apple-touch-icon" href="/icons/icon-light-1024.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-ios-120x120.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-ios-152x152.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-ios-167x167.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-ios-180x180.png" />

    <!-- iOS Web App Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="BRC" />

    <!-- FOUC Prevention: Apply theme BEFORE React loads -->
    <!-- This script runs synchronously before any styles are applied -->
    <!-- It prevents the "flash of light mode" when user has dark mode selected -->
    <!-- Also dynamically sets app icon for Dev vs Prod identification -->
    <script>
      (function() {
        try {
          const theme = localStorage.getItem('settings_theme') || 'system'
          let actualTheme = theme

          if (theme === 'system') {
            actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
          }

          // Apply dark class immediately if needed
          if (actualTheme === 'dark') {
            document.documentElement.classList.add('dark')
          }
        } catch (e) {
          // Silently fail if localStorage unavailable
          // Theme will be applied by React/ThemeContext
        }

        // Dev/Prod Icon Detection
        // If running on dev URL, use dark icons for visual distinction
        const isDevMode = window.location.hostname.includes('dev')
        if (isDevMode) {
          // Replace all icon references with dark versions for Dev environment
          const iconLinks = document.querySelectorAll('link[rel*="icon"]')
          iconLinks.forEach(link => {
            if (link.href.includes('icon-light')) {
              link.href = link.href.replace('icon-light', 'icon-dark')
            }
            if (link.href.includes('apple-touch-icon') && link.href.includes('icon-light')) {
              link.href = link.href.replace('icon-light', 'icon-dark')
            }
          })
          console.log('ðŸ”§ [DEV MODE] Using dark icons for visual distinction')
        }
      })()
    </script>

    <!-- PWA Manifest Version Check for Icon Updates -->
    <!-- Automatically detects app updates and prompts user to refresh -->
    <script>
      (function() {
        const MANIFEST_VERSION = '1.1.1'
        const STORAGE_KEY = 'brc_manifest_version'
        const CHECK_INTERVAL = 24 * 60 * 60 * 1000 // 24 hours - adjust as needed

        // Check for manifest updates periodically
        function checkForUpdates() {
          // Store current version
          const lastVersion = localStorage.getItem(STORAGE_KEY) || '0.0.0'

          if (lastVersion !== MANIFEST_VERSION) {
            // Version changed - store new version
            localStorage.setItem(STORAGE_KEY, MANIFEST_VERSION)

            // Log update for debugging
            if (lastVersion !== '0.0.0') {
              console.log(`[BRC] App updated: ${lastVersion} â†’ ${MANIFEST_VERSION}`)
              console.log('[BRC] New icons and features available. Refresh the page for updates.')
            }
          }
        }

        // Run check on page load
        checkForUpdates()

        // Periodically check for updates (default: every 24 hours)
        // Adjust CHECK_INTERVAL constant above to change frequency
        setInterval(checkForUpdates, CHECK_INTERVAL)

        // Also check when user returns to tab after being away
        document.addEventListener('visibilitychange', function() {
          if (!document.hidden) {
            checkForUpdates()
          }
        })
      })()
    </script>

    <title>Bible Reading Companion</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
